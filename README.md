# Bare-Metal Cluster Orchestrator (Go)

–ü—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å–∏—Å—Ç–µ–º—ã –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –¥–ª—è bare-metal/VDS –æ–∫—Ä—É–∂–µ–Ω–∏–π –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏–∏ (Docker/Kubernetes). –°–∏—Å—Ç–µ–º–∞ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤ –ø–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏.

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–°–∏—Å—Ç–µ–º–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:

1.  **Service Controller (–°–ö / –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä)**:
    *   –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –º–æ–∑–≥ –∫–ª–∞—Å—Ç–µ—Ä–∞.
    *   –•—Ä–∞–Ω–∏—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ (Desired State vs Actual State).
    *   –í—ã–ø–æ–ª–Ω—è–µ—Ç Service Discovery –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏ (Round-Robin Proxy).
    *   –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–∞–º–æ–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ (Self-healing) –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —É–∑–ª–æ–≤.
    *   –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

2.  **Service Agent (–°–ê / –ê–≥–µ–Ω—Ç)**:
    *   –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º —Ö–æ—Å—Ç–µ (–Ω–æ–¥–µ).
    *   –°–ª—É—à–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –æ—Ç –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞.
    *   –£–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –û–° (–∑–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ Worker'–∞).
    *   –ù–µ —Ö—Ä–∞–Ω–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ª–æ–∫–∞–ª—å–Ω–æ.

3.  **Payload Worker (–°–ü–ü / –í–æ—Ä–∫–µ—Ä)**:
    *   –≠–º—É–ª–∏—Ä—É–µ—Ç –ø–æ–ª–µ–∑–Ω—É—é –Ω–∞–≥—Ä—É–∑–∫—É (–±–∏–∑–Ω–µ—Å-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ).
    *   –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ —Å–ª—É—á–∞–π–Ω–æ–º –ø–æ—Ä—Ç—É.
    *   –ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑–≤–Ω–µ –Ω–∞–ø—Ä—è–º—É—é (—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞).

---

## üöÄ –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
*   –û–°: Windows (–æ—Å–Ω–æ–≤–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏) –∏–ª–∏ Linux/macOS.
*   Go 1.18+.
*   Curl –∏–ª–∏ Postman –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.

### –°–±–æ—Ä–∫–∞
–°–∫–æ–º–ø–∏–ª–∏—Ä—É–π—Ç–µ –≤—Å–µ —Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–∞. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
go mod init cluster # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
go get github.com/google/uuid # –°–∫–∞—á–∏–≤–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É

# –î–ª—è Windows (PowerShell/CMD)
go build -o worker.exe ./worker
go build -o agent.exe ./agent
go build -o controller.exe ./controller

# –î–ª—è Linux/macOS
go build -o worker ./worker
go build -o agent ./agent
go build -o controller ./controller
```

> **–í–∞–∂–Ω–æ:** –§–∞–π–ª `worker.exe` –¥–æ–ª–∂–µ–Ω –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Ç–æ–π –∂–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –æ—Ç–∫—É–¥–∞ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è `agent.exe`, –∏–ª–∏ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–º –≤ —Å–∏—Å—Ç–µ–º–Ω–æ–º PATH.

---

## üñ•Ô∏è –ó–∞–ø—É—Å–∫ –¥–µ–º–æ-–∫–ª–∞—Å—Ç–µ—Ä–∞ (–õ–æ–∫–∞–ª—å–Ω–æ)

–î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –º—ã —ç–º—É–ª–∏—Ä—É–µ–º –∫–ª–∞—Å—Ç–µ—Ä –∏–∑ 2-—Ö —É–∑–ª–æ–≤ –∏ 1-–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –Ω–∞ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω–µ, –∏—Å–ø–æ–ª—å–∑—É—è —Ä–∞–∑–Ω—ã–µ –ø–æ—Ä—Ç—ã.

–û—Ç–∫—Ä–æ–π—Ç–µ 3 —Ç–µ—Ä–º–∏–Ω–∞–ª–∞:

**–¢–µ—Ä–º–∏–Ω–∞–ª 1 (Node 1):**
```bash
./agent.exe -port 9091
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 2 (Node 2):**
```bash
./agent.exe -port 9092
```

**–¢–µ—Ä–º–∏–Ω–∞–ª 3 (Controller):**
```bash
./controller.exe
```
*–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É 8000.*

---

## üéÆ –°—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (API)

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞ (–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ö–æ—Å—Ç–æ–≤)
–°–æ–æ–±—â–∏–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É, –≥–¥–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞—à–∏ –∞–≥–µ–Ω—Ç—ã.

```bash
curl -X POST http://localhost:8000/add-node -d "{\"url\":\"http://localhost:9091\"}"
curl -X POST http://localhost:8000/add-node -d "{\"url\":\"http://localhost:9092\"}"
```

### 2. –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ (Scale Up)
–ü–æ–¥–∞–µ–º –∫–æ–º–∞–Ω–¥—É –Ω–∞ –∑–∞–ø—É—Å–∫ 4-—Ö —Ä–µ–ø–ª–∏–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç –∏—Ö –º–µ–∂–¥—É –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ —É–∑–ª–∞–º–∏ (9091 –∏ 9092).

```bash
curl -X POST http://localhost:8000/scale -d "{\"count\": 4}"
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ—Å—Ç–æ—è–Ω–∏—è (–ö–∞—Ä—Ç–∞ –ö–ª–∞—Å—Ç–µ—Ä–∞)
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö —Ä–µ–ø–ª–∏–∫, –∏—Ö ID, –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –∏ –ø—Ä–∏–≤—è–∑–∫—É –∫ –Ω–æ–¥–∞–º.

```bash
curl http://localhost:8000/status
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫)
–û–±—Ä–∞—â–∞–µ–º—Å—è –∫ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—É –∫–∞–∫ –∫ –ø—Ä–æ–∫—Å–∏. –ó–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –Ω–∞ —Ä–∞–∑–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã (Round-Robin).

```bash
curl http://localhost:8000/
# –û—Ç–≤–µ—Ç: Hello from Worker ID: <uuid>. Uptime: ...
```

### 5. –£–º–µ–Ω—å—à–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ (Scale Down)
–£–º–µ–Ω—å—à–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫ –¥–æ 2. –õ–∏—à–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –±—É–¥—É—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã.

```bash
curl -X POST http://localhost:8000/scale -d "{\"count\": 2}"
```

### 6. –¢–µ—Å—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ (Failover)
–°—Ü–µ–Ω–∞—Ä–∏–π: "–ü–∞–¥–µ–Ω–∏–µ —Ö–æ—Å—Ç–∞".

1.  –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ä–µ–ø–ª–∏–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ –æ–±–æ–∏–º –∞–≥–µ–Ω—Ç–∞–º (`/status`).
2.  **–û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ** (Ctrl+C) –ø—Ä–æ—Ü–µ—Å—Å `agent.exe` –≤ **–¢–µ—Ä–º–∏–Ω–∞–ª–µ 2** (–ø–æ—Ä—Ç 9092).
3.  –ü–æ–¥–æ–∂–¥–∏—Ç–µ 3-6 —Å–µ–∫—É–Ω–¥ (–∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è).
4.  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞: –æ–Ω –æ–±–Ω–∞—Ä—É–∂–∏—Ç –ø–æ—Ç–µ—Ä—é —Å–≤—è–∑–∏.
5.  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `/status`: –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ—Ç–µ—Ä—è–Ω–Ω—ã–µ —Ä–µ–ø–ª–∏–∫–∏ –Ω–∞ –≤—ã–∂–∏–≤—à–µ–º —É–∑–ª–µ (–ø–æ—Ä—Ç 9091).

### 7. –í–≤–æ–¥ –Ω–æ–≤–æ–≥–æ —É–∑–ª–∞ (Recovery)
1.  –°–Ω–æ–≤–∞ –∑–∞–ø—É—Å—Ç–∏—Ç–µ `agent.exe` –Ω–∞ –ø–æ—Ä—Ç—É 9092.
2.  –£–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∏–∫:
    ```bash
    curl -X POST http://localhost:8000/scale -d "{\"count\": 6}"
    ```
3.  –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä —Å–Ω–æ–≤–∞ –Ω–∞—á–Ω–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —É–∑–µ–ª –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ä–µ–ø–ª–∏–∫.

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
/
‚îú‚îÄ‚îÄ agent/            # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ê–≥–µ–Ω—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ controller/       # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞
‚îÇ   ‚îî‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ worker/           # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ü–æ–ª–µ–∑–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ agent.exe         # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫
‚îú‚îÄ‚îÄ controller.exe    # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫
‚îú‚îÄ‚îÄ worker.exe        # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫
‚îî‚îÄ‚îÄ README.md
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–í —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ (–∞—Ä–≥—É–º–µ–Ω—Ç—ã, –∏–º—è –±–∏–Ω–∞—Ä–Ω–∏–∫–∞) —ç–º—É–ª–∏—Ä—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–¥–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ (—Ñ—É–Ω–∫—Ü–∏—è `loadConfigFromS3`), —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é "Mock S3".

---
*–ü—Ä–æ–µ–∫—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ —Ä–∞–º–∫–∞—Ö —É—á–µ–±–Ω–æ–≥–æ –∫—É—Ä—Å–∞ –ø–æ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.*
